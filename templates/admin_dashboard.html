{% extends "base.html" %}

{% block title %}Admin Dashboard{% endblock %}

{% block content %}
<h2 class="mb-4">Admin Dashboard</h2>

<section class="my-4">
    <h3>Pending Hotel Approvals</h3>
    {% set pending_hotels = hotels|selectattr("is_approved", "equalto", false)|list %}
    {% if pending_hotels %}
    <div class="table-responsive">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Owner</th>
                    <th>Location</th>
                    <th>Price</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for hotel in pending_hotels %}
                <tr>
                    <td>{{ hotel.name }}</td>
                    <td>{{ hotel.owner_user.username if hotel.owner_user else 'N/A' }}</td>
                    <td>{{ hotel.location }}</td>
                    <td>${{ "%.2f"|format(hotel.price_per_night) }}</td>
                    <td>
                        <form action="{{ url_for('approve_hotel', hotel_id=hotel.id) }}" method="POST" class="d-inline">
                            <button type="submit" class="btn btn-sm btn-success">Approve</button>
                        </form>
                        <form action="{{ url_for('reject_hotel', hotel_id=hotel.id) }}" method="POST" class="d-inline">
                            <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure you want to reject and remove this hotel?');">Reject</button>
                        </form>
                        <a href="{{ url_for('hotel_detail', hotel_id=hotel.id) }}" class="btn btn-sm btn-info">View</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <p>No hotels pending approval.</p>
    {% endif %}
</section>

<hr>

<section class="my-4">
    <h3>All Hotels</h3>
    {% if hotels %}
    <div class="table-responsive">
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Owner</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for hotel in hotels %}
                <tr>
                    <td>{{ hotel.id }}</td>
                    <td>{{ hotel.name }}</td>
                    <td>{{ hotel.owner_user.username if hotel.owner_user else 'N/A' }}</td>
                    <td>
                        {% if hotel.is_approved %}
                        <span class="badge bg-success">Approved</span>
                        {% else %}
                        <span class="badge bg-warning text-dark">Pending</span>
                        {% endif %}
                    </td>
                    <td>
                        <a href="{{ url_for('hotel_detail', hotel_id=hotel.id) }}" class="btn btn-sm btn-info">View</a>
                        {% if not hotel.is_approved %}
                        <form action="{{ url_for('approve_hotel', hotel_id=hotel.id) }}" method="POST" class="d-inline">
                            <button type="submit" class="btn btn-sm btn-success">Approve</button>
                        </form>
                        {% endif %}
                        <form action="{{ url_for('reject_hotel', hotel_id=hotel.id) }}" method="POST" class="d-inline">
                            <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure you want to remove this hotel?');">Remove</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <p>No hotels registered in the system.</p>
    {% endif %}
</section>

<hr>

<section class="my-4">
    <h3>All Bookings</h3>
    {% if bookings %}
    <div class="table-responsive">
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>User</th>
                    <th>Hotel</th>
                    <th>Check-in</th>
                    <th>Check-out</th>
                    <th>Total Price</th>
                </tr>
            </thead>
            <tbody>
                {% for booking in bookings %}
                <tr>
                    <td>{{ booking.id }}</td>
                    <td>{{ booking.booker.username if booking.booker else 'N/A' }}</td>
                    <td>{{ booking.hotel.name if booking.hotel else 'N/A' }}</td>
                    <td>{{ booking.check_in_date.strftime('%Y-%m-%d') }}</td>
                    <td>{{ booking.check_out_date.strftime('%Y-%m-%d') }}</td>
                    <td>${{ "%.2f"|format(booking.total_price) }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <p>No bookings in the system.</p>
    {% endif %}
</section>

<hr>

<section class="my-4">
    <h3>All Users</h3>
    {% if users %}
    <div class="table-responsive">
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Username</th>
                    <th>Email</th>
                    <th>Role</th>
                </tr>
            </thead>
            <tbody>
                {% for user in users %}
                <tr>
                    <td>{{ user.id }}</td>
                    <td>{{ user.username }}</td>
                    <td>{{ user.email }}</td>
                    <td>{{ user.role }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <p>No users registered in the system.</p>
    {% endif %}
</section>
{% endblock %}
