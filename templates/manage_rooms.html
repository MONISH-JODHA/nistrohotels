{% extends "base.html" %}

{% block title %}Manage Rooms - {{ hotel.name }}{% endblock %}

{% block head_extra %}
<style>
    .room-list-item {
        background-color: #fff;
        border: 1px solid #eef2f7;
        border-radius: 12px;
        transition: box-shadow 0.2s ease, transform 0.2s ease;
        display: flex;
        padding: 1rem;
        align-items: center;
        gap: 1.5rem;
    }
    .room-list-item:hover {
        transform: translateY(-4px);
        box-shadow: 0 4px 15px rgba(0,0,0,0.08);
    }
    .room-thumbnail {
        width: 120px;
        height: 90px;
        object-fit: cover;
        border-radius: 8px;
        flex-shrink: 0;
    }
    .room-info {
        flex-grow: 1;
    }
    .room-actions {
        display: flex;
        flex-wrap: nowrap;
        align-items: center;
        gap: 0.5rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="container my-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="h2 fw-bold" style="color: #2c3e50;">Manage Rooms</h1>
            <p class="text-muted mb-0">For hotel: <a href="{{ url_for('hotel_detail', hotel_id=hotel.id) }}">{{ hotel.name }}</a></p>
        </div>
        <div>
            <a href="{{ url_for('owner_dashboard') }}" class="btn btn-outline-secondary me-2">Back to Dashboard</a>
            <a href="{{ url_for('register_hotel') }}" class="btn btn-primary" style="background-color: #00796B; border-color: #00796B;" data-bs-toggle="modal" data-bs-target="#addRoomModal">
                <i class="fas fa-plus me-2"></i> Add New Room Type
            </a>
        </div>
    </div>
    
    <div class="list-group list-group-flush">
        {% for room in room_types %}
        <div class="list-group-item room-list-item mb-3">
            {% set room_img_src = room.main_image_url if room.main_image_url and (room.main_image_url.startswith('http') or room.main_image_url.startswith('/static')) else 'https://images.unsplash.com/photo-1611892440504-42a792e24d32?auto=format&fit=crop&w=800&q=80' %}
            <img src="{{ room_img_src }}" alt="{{ room.name }}" class="room-thumbnail">
            
            <div class="room-info">
                <h5 class="mb-1 fw-bold" style="color: #34495e;">{{ room.name }}</h5>
                <p class="mb-1"><span class="fw-bold text-success">₹{{ "%.2f"|format(room.price_per_night) }}</span> / night</p>
                <small class="text-muted">{{ room.number_of_rooms }} available rooms</small>
            </div>
            
            <div class="room-actions">
                <a href="{{ url_for('manage_availability', hotel_id=hotel.id, room_type_id=room.id) }}" class="btn btn-sm btn-info text-white" title="Manage dynamic pricing and availability">
                    <i class="fas fa-calendar-alt"></i><span class="d-none d-md-inline ms-2">Availability</span>
                </a>
                <a href="{{ url_for('edit_room', hotel_id=hotel.id, room_type_id=room.id) }}" class="btn btn-sm btn-secondary" title="Edit room details">
                    <i class="fas fa-edit"></i><span class="d-none d-md-inline ms-2">Edit</span>
                </a>
                <form action="{{ url_for('delete_room', hotel_id=hotel.id, room_type_id=room.id) }}" method="POST" class="d-inline" onsubmit="return confirm('Are you sure you want to delete this room? This cannot be undone.');">
                    <button type="submit" class="btn btn-sm btn-outline-danger" title="Delete room">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </form>
            </div>
        </div>
        {% else %}
        <div class="text-center p-5" style="background-color: #f8f9fa; border-radius: 12px;">
            <p class="lead text-muted">No room types have been added yet. Click 'Add New Room Type' to get started.</p>
        </div>
        {% endfor %}
    </div>
</div>

<!-- Add Room Modal -->
<div class="modal fade" id="addRoomModal" tabindex="-1" aria-labelledby="addRoomModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content" style="border-radius: 1rem; border: none;">
            <form id="addRoomForm" method="POST" action="{{ url_for('manage_rooms', hotel_id=hotel.id) }}" enctype="multipart/form-data">
                <div class="modal-header border-0">
                    <h5 class="modal-title fw-bold" id="addRoomModalLabel" style="color: #2c3e50;">Add New Room Type</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-4">
                    <div class="row g-3">
                        <div class="col-12"><label for="add_name" class="form-label">Room Type Name *</label><input type="text" class="form-control" id="add_name" name="name" required></div>
                        <div class="col-md-6"><label for="add_price_per_night" class="form-label">Price per Night (₹) *</label><input type="number" step="0.01" class="form-control" id="add_price_per_night" name="price_per_night" required></div>
                        <div class="col-md-6"><label for="add_number_of_rooms" class="form-label">Number of Rooms *</label><input type="number" class="form-control" id="add_number_of_rooms" name="number_of_rooms" required></div>
                        <div class="col-12"><label for="add_description" class="form-label">Description</label><textarea class="form-control" id="add_description" name="description" rows="3"></textarea></div>
                        <div class="col-12"><label for="add_amenities" class="form-label">Amenities (comma-separated)</label><input type="text" class="form-control" id="add_amenities" name="amenities" placeholder="e.g., Balcony, Jacuzzi"></div>
                    </div>
                    
                    <hr class="my-4">
                    <h6 class="fw-bold">Room Images</h6>
                    <div class="mb-3"><label for="add_main_image_url" class="form-label">Main Display Image URL</label><input type="url" class="form-control" id="add_main_image_url" name="main_image_url" placeholder="https://..."><div class="form-text">Leave blank to use the first uploaded image.</div></div>
                    <div class="mb-3"><label for="add_gallery_images_upload" class="form-label">Upload New Gallery Images</label><input class="form-control" type="file" id="add_gallery_images_upload" name="gallery_images_upload" multiple></div>
                </div>
                <div class="modal-footer border-0">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary" style="background-color: #00796B; border-color: #00796B;"><i class="fas fa-save me-2"></i>Save Room</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}
